# 生成 Claude Skill 完整结构模板
你正在为 `task-plan-mcp-server` MCP Server 生成 Claude Skill。

## 基本信息
- Skill 名称：task-plan-assistant
- 领域：智能任务规划与执行
- 使用场景：复杂任务分解、工具调用规划、执行进度追踪、经验沉淀

## 文件位置
生成到：当前目录/.claude/skills/task-plan-assistant/

## 核心功能
这个 Skill 帮我：
1. 规划复杂任务的执行步骤
2. 动态注册工具并生成执行计划
3. 追踪执行结果并自动学习优化
4. 复用历史经验提升规划质量

## 架构要求
1. 生成完整的 YAML frontmatter（name + description）
2. 在 workflows/ 目录创建独立的 workflow 文件
3. 每个 workflow 包含具体检查项（checkbox 格式）+ 重要程度标注
4. 使用渐进式披露结构（SKILL.md 引用 workflows）

## 输出格式
1. 先输出目录结构说明
2. 然后逐个文件输出完整内容
3. 最后提供安装和验证步骤

---

## MCP Server 工具定义（供 Skill 使用）

当前 MCP Server 提供3个工具：

### 1. create_context
**用途**：创建规划上下文，隔离任务记忆

**必需参数**：
- `name`: 上下文名称（字符串，必填）

**可选参数**：
- `description`: 任务描述（字符串）
- `parent_context_id`: 父上下文ID（字符串，用于复用历史记忆）
- `agent`: 代理信息（对象，包含 name、role、environment、terminal_type、terminal_user）

**调用时机**：每个任务开始时必须调用

**返回**：
```json
{
  "success": true,
  "context_id": "ctx_xxx",
  "name": "任务名称",
  "description": "任务描述",
  "created_at": "2024-01-01T00:00:00"
}
```

**示例**：
```json
{
  "name": "feature_development",
  "description": "开发用户认证模块",
  "agent": {"name": "Trae", "role": "software_engineer"}
}
```

---

### 2. decision
**用途**：根据任务动态规划下一步行动序列，返回 next_action 列表

**必需参数**：
- `context_id`: 上下文ID（字符串，必填）
- `query`: 查询内容（字符串，必填）

**可选参数**：
- `tools`: 动态工具定义数组（数组），包含以下字段：
  - `domain`: 工具领域（字符串，必填）
  - `tool_name`: 工具名称（字符串，必填）
  - `description`: 工具描述（字符串，必填）
  - `args`: 参数定义（对象）
  - `input`: 输入结构（对象）
  - `output`: 输出结构（对象）

**调用时机**：
- 遇到复杂任务需要规划时
- 不确定下一步操作时
- 需要查询历史经验时

**返回**：
```json
{
  "success": true,
  "plan_id": "plan_xxx",
  "context_id": "ctx_xxx",
  "query": "用户查询",
  "steps": [
    {"step_id": "step_1", "tool_name": "Read", "domain": "file_system", ...},
    {"step_id": "step_2", "tool_name": "Write", "domain": "file_system", ...}
  ],
  "continuation": [],
  "context": {},
  "created_at": "2024-01-01T00:00:00",
  "next_action": [
    {"tool_name": "decision", "domain": "system", "condition": "if next need continue decision"},
    {"tool_name": "report_action_result", "domain": "system", "condition": "if next need continue report action result"}
  ]
}
```

**步骤结构**：
- `step_id`: 步骤唯一ID
- `tool_name`: 工具名称
- `domain`: 工具领域
- `parameters`: 调用参数
- `depends_on`: 依赖步骤列表
- `reasoning`: 执行原因
- `expected_output`: 期望输出

**重要**：decision 返回的 steps 需要客户端自行转换为执行步骤，每步执行完毕后调用 report_action_result上报结果。

**示例**：
```json
{
  "context_id": "ctx_123",
  "query": "开发用户认证模块",
  "tools": [
    {"domain": "file", "tool_name": "Write", "description": "写入文件", "args": {}, "input": {}, "output": {}}
  ]
}
```

---

### 3. report_action_result
**用途**：统一上报执行结果和决策反馈，通过 type 参数区分

**必需参数**：
- `context_id`: 上下文ID（字符串，必填）
- `type`: 报告类型（字符串，必填，值为 "plan_feedback" 或 "tool_execution_feedback"）

**plan_feedback 模式**：
- `messages`: 消息数组（数组，必填）
- 可选：`plan_id`, `metadata`

**tool_execution_feedback 模式**：
- `tool_execution_feedback`: 执行反馈数组（数组，必填）
- 可选：`plan_id`, `messages`, `metadata`

**tool_execution_feedback 结构**：
- `tool_name`: 工具名称（字符串，必填）
- `success`: 是否成功（布尔值，必填）
- `input`: 输入参数（任意类型）
- `output`: 输出结果（任意类型）
- `execution_time`: 执行时间（数字）
- `error`: 错误信息（字符串）
- `step_id`: 步骤ID（字符串）
- `domain`: 工具领域（字符串）
- `create_time`: 创建时间（字符串）
- `token_cost`: token消耗（整数）

**示例**：
```json
{
  "context_id": "ctx_xxx",
  "type": "tool_execution_feedback",
  "plan_id": "plan_xxx",
  "tool_execution_feedback": [
    {
      "step_id": "step_1",
      "tool_name": "Read",
      "domain": "file_system",
      "success": true,
      "input": {"file_path": "/src/main.py"},
      "output": {"content": "..."},
      "execution_time": 150
    }
  ]
}
```

---

## 任务执行标准流程

### 第一阶段：任务开始
1. 调用 `create_context` 创建上下文
2. 记录返回的 `context_id`

### 第二阶段：任务执行
1. 调用 `decision` 获取 `next_action` 序列
2. 按顺序执行 `next_action` 中的每个步骤
3. 每个工具调用后立即调用 `report_action_result` (type: "tool_execution_feedback")
4. 遇到重要决策时立即调用 `report_action_result` (type: "plan_feedback")
5. **最后一步 report_action_result 必须执行**：确保所有执行结果同步到内存

### 第三阶段：任务收尾
1. 确认所有 `next_action` 已执行完毕
2. 确认 `report_action_result` 已调用
3. 如有遗漏，立即补报
