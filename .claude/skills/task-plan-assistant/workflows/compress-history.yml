---
name: Compress History Messages
description: 压缩历史消息以减少上下文长度，同时保持关键信息完整性
---

# 压缩历史消息

## 工具调用
`mcp_task_plan_server_compress_history_messages`

## 参数说明

| 参数 | 必需 | 说明 |
|------|------|------|
| context_id | ✅ | 上下文 ID |
| messages | ✅ | 待压缩的消息列表 |
| compact_ratio_threshold | ❌ | 压缩比率阈值 (默认 0.75) |
| keep_recent_count | ❌ | 保留的最近消息数 (默认 1) |
| max_total_tokens | ❌ | 最大 Token 数 (默认 20000) |
| max_tool_message_tokens | ❌ | 最大工具消息 Token (默认 2000) |
| working_summary_mode | ❌ | 压缩模式 (auto/manual) |

## 检查项

### ⭐⭐⭐ 压缩配置
- [ ] 设置合理的压缩比率
- [ ] 保留关键最近消息
- [ ] 限制最大 Token 数量

### ⭐⭐ 模式选择
- [ ] 自动模式适合大多数场景
- [ ] 手动模式用于精细控制
- [ ] 根据消息类型选择模式

### ⭐ 高级配置
- [ ] 调整工具消息 Token 限制
- [ ] 设置分批压缩策略
- [ ] 验证压缩后信息完整性

## 使用示例

```yaml
压缩当前上下文的历史消息：
上下文 ID：context-003
压缩比率：0.8
保留最近 3 条消息
最大 Token：15000
```
